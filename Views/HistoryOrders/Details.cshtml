@model PetShop.Models.Order

@{
    ViewData["Title"] = "Order Details";
    var deliveryFee = 9.99f;
    var subtotal = (Model.TotalPrice ?? 0) - deliveryFee;
}

<div class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold mb-1">Order Details</h2>
            <p class="text-muted mb-0">
                Order <span class="fw-bold text-dark">#@Model.Id</span> •
                Placed on @Model.Date.ToLocalTime().ToString("dd MMMM yyyy, HH:mm")
            </p>
        </div>
        <div>
            <span class="badge bg-success bg-opacity-10 text-success fs-6 px-3 py-2 rounded-pill">
                @Model.statusOrder
            </span>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm rounded-4 mb-4">
                <div class="card-header bg-white border-bottom-0 pt-4 px-4">
                    <h5 class="fw-bold">Items Ordered</h5>
                </div>
                <div class="card-body p-4">
                    @if (Model.OrderItems != null && Model.OrderItems.Any())
                    {
                        foreach (var item in Model.OrderItems)
                        {
                            <div class="d-flex align-items-center mb-4">
                                <div class="flex-shrink-0" style="width: 80px; height: 80px; border-radius: 12px; overflow: hidden; background-color: #f8f9fa; display:flex; align-items:center; justify-content:center;">
                                    @if (item.Product?.ProductImage != null)
                                    {
                                        <img src="data:image/png;base64,@Convert.ToBase64String(item.Product.ProductImage)" style="width: 100%; height: 100%; object-fit: cover;" />
                                    }
                                    else
                                    {
                                        <i class="fa-solid fa-image text-muted fa-lg"></i>
                                    }
                                </div>

                                <div class="flex-grow-1 ms-3">
                                    <h6 class="mb-1 fw-bold">@(item.Product?.Name ?? "Unknown Product")</h6>
                                    <div class="small text-muted">
                                        Unit Price: @(item.Product?.Price.ToString("0.00") ?? "0.00") Lei
                                    </div>
                                </div>

                                <div class="text-end">
                                    <div class="small text-muted mb-1">Qty: x @item.Quantity</div>
                                    <div class="fw-bold">
                                        @(((item.Product?.Price ?? 0) * item.Quantity).ToString("0.00")) Lei
                                    </div>
                                </div>
                            </div>


                            @if (item != Model.OrderItems.Last())
                            {
                                <hr class="border-light my-3" />
                            }
                        }
                    }
                </div>
            </div>
        </div>

        <div class="col-lg-4">

            <div class="card border-0 shadow-sm rounded-4 mb-3">
                <div class="card-body p-4">
                    <h6 class="fw-bold text-uppercase text-muted small mb-3">
                        <i class="fa-solid fa-truck-fast me-2"></i>Delivery Address
                    </h6>
                    @if (Model.Address != null)
                    {
                        <p class="mb-1 fw-bold">Phone Number: @Model.Address.PhoneNumber</p>
                        <p class="mb-0 text-secondary">
                            @Model.Address.Street <br />
                            @Model.Address.City, @Model.Address.County <br />
                            @Model.Address.ZipCode
                        </p>
                    }
                    else
                    {
                        <p class="text-danger small mb-0">Address information missing.</p>
                    }
                </div>
            </div>

            <div class="card border-0 shadow-sm rounded-4">
                <div class="card-body p-4">
                    <h6 class="fw-bold text-uppercase text-muted small mb-3">Order Summary</h6>

                    <div class="d-flex justify-content-between mb-2">
                        <span class="text-muted">Subtotal</span>
                        <span>@subtotal.ToString("0.00") Lei</span>
                    </div>
                    <div class="d-flex justify-content-between mb-3">
                        <span class="text-muted">Delivery Fee</span>
                        <span>@deliveryFee.ToString("0.00") Lei</span>
                    </div>

                    <hr />

                    <div class="d-flex justify-content-between align-items-center">
                        <span class="fw-bold fs-5">Total</span>
                        <span class="fw-bold fs-4 text-primary">@((Model.TotalPrice ?? 0).ToString("0.00")) Lei</span>
                    </div>
                </div>
            </div>

            <div class="mt-4 text-center">
                <a asp-action="Index" class="btn btn-outline-secondary rounded-pill px-4">
                    <i class="fa-solid fa-arrow-left me-2"></i>Back to History
                </a>
            </div>

        </div>
    </div>
</div>